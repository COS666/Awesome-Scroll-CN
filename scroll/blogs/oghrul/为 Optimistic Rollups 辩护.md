作者：[oghrul Maharramov](https://mirror.xyz/toghrulmaharram.eth)
致谢：感谢[Daniel Goldman](https://twitter.com/DZack23)和[Kelvin Fichter](https://twitter.com/kelvinfichter)的评论.
翻译：Junwei

关于 Optimistic Rollups ( 以下简称 ORU) 的安全性已经争论许久。在许多情况下，对 ORU 安全性的担忧源于缺乏详细阐述 ORU 基本属性的文献。

在这篇短文中，我试图整理在讨论 ORU 的安全性时经常遇到的问题。

## 1 / N 诚实假设

ORU 是乐观的。换句话说，ORU 在诚实假设下强制执行状态转换的正确性（即在被证明有罪之前是无辜的）。当一个 ORU Batch 及其相应的状态根被提交到底层时，验证桥分配一个预定义的时间，称为挑战期。通常，挑战期设置为 7 天。在上述挑战期内，任何旁观者都可以发起挑战来质疑状态根承诺的正确性（关于争议解决机制的细节我就不多说了）。

眼尖的读者可能会推断出，成功执行状态转换的正确性依赖于诚实假设。具体来说，一个 1 / N（其中 N 可以是无上限的）的诚实假设。虽然在表面上，这可能感觉像是对仅依赖于数学假设的 zkRollup 的明显降级，但实际上，差异并没有那么大。为了使假设成立，必须至少有一个运行 ORU 全节点的实体能够标记无效状态根承诺，并在挑战期到期之前挑战其正确性。假设运行 ORU 全节点的硬件要求不是特别高，我很难想象在任何给定时间点都没有一个全节点正确运行的场景。假设在 ORU 之上运行的基础设施提供商（例如跨链桥运营者）有经济激励来保持 ORU 链的正确性时，概率变得极小甚至可以忽略不计。换句话说，只要协议拥有良好的用户基础，无效状态承诺被验证桥成功验证的可能性就可以忽略不计。

## 最终确认

“您必须等待 7 天才能完成 ORU 交易！！！” ，这句话可能会引起每个在构建 ORU 的人的不满。这句话有什么道理吗？

首先，让我们解析 ORU 的某些特性。在 ORU 中，排序交易的过程完全脱离了执行过程。这意味着如果 Sequencer 要提交包含无效交易的 Batch（例如，签名格式不正确的交易），则不必丢弃整个批次；但执行器在计算新的状态根时必须跳过上述交易。

你可能已经从上一句中猜到了，脱媒意味着 ORU 全节点在相应的 Batch 承诺在底层被最终确认后立即计算 Batch 的输出状态。你可能会问：“嗯，那为什么需要一个长达 7 天的挑战期？？？” 。你看，这有一个陷阱。虽然 ORU 全节点可以确信从 Batch 承诺派生的某个状态已经被最终确认，但验证桥并不知道这一点，因此必须等待 7 天才能确认结果状态的正确性。因此，ORU 全节点和验证桥对最终确认的视角是不同的：前者在相应的 Batch 承诺在基础层上被最终确认后立即确认状态，后者在挑战期满后确认状态。如果你在 ORU 内进行交易而不是桥接回底层的基础层，则你不需要关心验证桥的最终确认。但是，如果你要桥接回底层，那么你将被迫等待验证桥的最终确认。

## 挑战者审查

几周前，Anatoly Yakovenko [提出了](https://twitter.com/aeyakovenko/status/1619228244980666369)一个与挑战者审查相关的 ORU 潜在攻击方向。乍一看，对于任何依赖于另一个协议的安全性来解决争议的 ORU 来说，上述攻击似乎是一个无法逾越的挑战，但现实情况总是复杂得多。

攻击可以归结为以下几点：底层基础层上不诚实的绝大多数提交了一个无效的状态根（他们自己或通过贿赂 ORU 运营者），使他们能够耗尽锁定在验证桥中的资金。在整个挑战期内，上述不诚实的多数人尽其所能审查发起争议的交易，包括不投票和孤立包含上述交易的任何区块。在挑战期结束后，由于验证桥确信上述行为是完全合法的，不诚实的绝大多数可以提取所有锁定的资金。

现在让我们剖析刚才所描述的攻击。假设存在正确运行的 ORU 全节点，无效的状态根承诺将被及时地标记。一旦挑战发起交易传播到底层，对它的审查尝试对任何人来说都应该是显而易见的。因此，ORU 社区在挑战期内应该有足够的时间来制造尽可能多的噪音，以团结基础层社区从审查链中分叉出来。协议中的主要利益相关者（例如基础设施运营者、部署在协议之上的应用程序、CEX 等）不太可能愿意支持一条试图窃取用户资金的链，从而导致这些实体加入少数者的分叉链。此时，对于不诚实的绝大多数者，有两个选择

1.  停止试图审查并包含挑战发起交易或   
2.  继续构建没有主要实体支持的分叉链，导致类似于 EthPoW 的情况，此时这条链尽管在技术上仍在运行，但由于应用程序运营者的不支持，实际上已经死亡。

因此，尝试通过无效的状态承诺窃取桥接到 ORU 的资金，以及随后尝试对相应的状态承诺进行审查的成功概率很低。

## 结论

许多关于 ORU 的错误观念源于底层技术的新颖性和涉及相关主题的公开文献积累缓慢（我们甚至无法就 “rollup” 的具体定义达成一致！）。

在这篇短文中，我试图消除在与其他人讨论 rollups 的过程中遇到最多的错误观念。如果你想到了其他任何本文中所未涉及的，请随时告诉我！